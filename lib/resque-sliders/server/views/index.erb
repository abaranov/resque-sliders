<% @subtabs = @sliders.all_hosts unless @sliders.all_hosts.length == 1 %>

<h1>Sliders</h1>

<div id="sliders">
<% if params[:host] || @sliders.all_hosts.length == 1 %>
<% host = params[:host] || @sliders.all_hosts.first %>
  <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/themes/blitzer/jquery-ui.css" rel="stylesheet" type="text/css" />
  <style type="text/css">
    #sliders {
      padding: 10px;
      width: 600px;
      margin: 0px 20px;
    }
    #sliders > p {
      padding: 0px;
      margin: 10px 0px;
    }
    #sliders form {
      padding: 10px 0px;
      float: left;
      margin: 0px auto;
    }
    input[id*='-value'] {
      border: 0;
      color: #CE1212;
      font-weight: bold;
      font-size: 105%;
    }
    div[id*='-slider'] {
      width: 500px;
      margin: 0px 20px;
    }
  </style>

  <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js" type="text/javascript"></script>
  <script type="text/javascript">
    $(document).ready(function() {
      // make each slider, get input from div content passed from erb
      $('.new_form').submit(function() {
        $.post('/sliders/<%= host %>', {quantity: 1, queue: $("#new_queue").val() }, function(data) {
        });
      });
      $("#plus-one").click(function() {
        $('.new_form').submit();
      });
      $(".slider").each(function() {
        var slidy = $(this);
        var value = parseInt( slidy.text() );
        var queue = slidy.attr("id").replace("-slider", "");
        slidy.prev().find("input").val( value );
        slidy.empty().slider({
          range: "min",
          value: value,
          min: 0,
          max: <%= @sliders.max_children(host) || 50 %>,
          slide: function( event, ui ) {
            slidy.prev().find("input").val( ui.value );
          },
          change: function( event, ui ) {
            $.post('/sliders/<%= host %>', {quantity: ui.value, queue: slidy.attr('id').split('-').slice(0,-1).join(',')}, function(data) {
            });
          },
        });
      });
    });
  </script>
  <% max = @sliders.max_children(host) || 'unknown (Not running)' %>
  <h2><%= host %><%= " (max: #{max})" %></h2>
  <% @sliders.queue_values(host).each_pair do |queue,value| %>
    <p>
      <label for="value"><%= queue %>: </label>
      <input type="text" id="<%= queue %>-value" />
    </p>
    <div id="<%= queue.gsub(',', '-') %>-slider" class="slider"><%= value %></div>
  <% end %>
    <form class="new_form">
      <input type="text" id="new_queue" />
      <span id="plus-one" type="submit" class="ui-icon ui-icon-plus ui-corner-all ui-state-default" /></span>
    </form>
<% else %>
    <table class="hosts">
      <tr>
        <th>Hostname</th>
        <th>Workers</th>
      </tr>
      <% @sliders.all_hosts.each do |host| %>
      <tr>
        <th><a href="/sliders/<%= host %>"><%= host %></a></th>
        <th><%= @sliders.max_children(host) || 'Not Checked in (Stale)' %></th>
      </tr>
      <% end %>
    </table>
<% end %>
</div>
