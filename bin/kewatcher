#!/usr/bin/env ruby

$LOAD_PATH.unshift File.expand_path(File.dirname(__FILE__) + '/../lib')

require 'rubygems'
require 'yaml'
require 'optparse'
require 'resque-sliders/kewatcher'

options = {
  :verbosity => 0,
  :max_children => 10
}

OptionParser.new do |opt|
  opt.banner = "Usage: #{$0} [options]"

  opt.separator ""
  opt.separator "Options:"

  opt.on("-c", "--config CONFIG", "Resque Config (Yaml)") do |config|
    options[:config] = YAML.load_file(File.expand_path(config))
  end

  opt.on("-r", "--rakefile RAKEFILE", "Rakefile location") do |rakefile|
    options[:rakefile] = rakefile
  end

  opt.on("-v", "--verbose", "Verbosity") do
    options[:verbosity] += 1
  end

  opt.on("-m", "--max MAX", "Max Children") do |max|
    options[:max_children] = max.to_i
  end

  opt.on("-h", "--help", "This help") do
    puts opt
    exit
  end

end.parse!

kewatcher = ResqueSliders::KEWatcher.new(options)
kewatcher.run!
